<?phpclass Reports_addContactsOrLeadsfromReportstoCampaign_Action extends Vtiger_Action_Controller {	function checkPermission(Vtiger_Request $request) {		return;	}	public function process(Vtiger_Request $request) {		global $adb;		$modulename = $request->get('modulename');		$reportid = $request->get('reportid');		$campaignlistid = $request->get('campaignlist');		$contactidlist = $request->get('contactids');		$contactidlist_array = array ();			$response = new Vtiger_Response();				if (!is_numeric($reportid) or !is_numeric($campaignlistid)) {			$result = 'FAILURE';		}		else {			//get the contacts from report			$contactidlist_array = explode('|', $contactidlist);			//clean up			$contactidlist_array = array_diff($contactidlist_array, array(''));			//add the contacts to campaign			if (count($contactidlist_array)!=0) {				$count_quantity = 0;				foreach ($contactidlist_array as $key=>$value)  {					if ($modulename == 'Contacts') {						//check whether this contact is still not deleted								$query = "select contactid from vtiger_contactdetails inner join vtiger_crmentity on vtiger_crmentity.crmid = vtiger_contactdetails.contactid where vtiger_crmentity.deleted =0 and contactid =?";						$result = $adb->pquery($query, array($value));						if($adb->num_rows($result)>0){							//check for duplicates							$dup_query = "Select `contactid` from `vtiger_campaigncontrel` where `campaignid`=? and `contactid`=? ";							$dup_result = $adb->pquery($dup_query, array($campaignlistid, $value));							if($adb->num_rows($dup_result) == 0){								//add to campaign								$query1 = "INSERT INTO `vtiger_campaigncontrel` (`campaignid` ,`contactid` ,`campaignrelstatusid`) VALUES (?, ?, ?)";								$result = $adb->pquery($query1, array($campaignlistid, $value, 1));								$count_quantity = $count_quantity +1;							}						}					}					else {						//Leads						//check whether this contact is still not deleted								$query = "select leadid from vtiger_leaddetails inner join vtiger_crmentity on vtiger_crmentity.crmid = vtiger_leaddetails.leadid where vtiger_crmentity.deleted =0 and leadid =?";						$result = $adb->pquery($query, array($value));						if($adb->num_rows($result)>0){							//check for duplicates							$dup_query = "Select `leadid` from `vtiger_campaignleadrel` where `campaignid`=? and `leadid`=? ";							$dup_result = $adb->pquery($dup_query, array($campaignlistid, $value));							if($adb->num_rows($dup_result) == 0){								//add to campaign								$query1 = "INSERT INTO `vtiger_campaignleadrel` (`campaignid` ,`leadid` ,`campaignrelstatusid`) VALUES (?, ?, ?)";								$result = $adb->pquery($query1, array($campaignlistid, $value, 1));								$count_quantity = $count_quantity +1;							}						}					}				}				if ($modulename == 'Contacts') {					if ($count_quantity < count($contactidlist_array)) {						$result = vtranslate('LBL_SUCCESS_CONTACT_LESS','Reports')." ".$count_quantity." ".vtranslate('LBL_SUCCESS_CONTACT_LESS1','Reports');					}					else {						$result = vtranslate('LBL_SUCCESS_CONTACT','Reports');					}				}				else {					if ($count_quantity < count($contactidlist_array)) {						$result = vtranslate('LBL_SUCCESS_LEAD_LESS','Reports')." ".$count_quantity." ".vtranslate('LBL_SUCCESS_LEAD_LESS1','Reports');					}					else {						$result = vtranslate('LBL_SUCCESS_LEAD','Reports');					}				}			}			else {				$result = vtranslate('LBL_NO_CONTACTS','Reports');			}		}		$response->setResult($result);		$response->emit();	}}?>